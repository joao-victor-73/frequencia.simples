{% extends 'base.html' %}

{% block conteudo %}
<!-- Importar SweetAlert2 -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<div class="container my-5">
    <div class="card shadow-sm border-0 rounded-4">
        <div class="card-header bg-white border-bottom-0 text-center py-4">
            <h2 class="card-title fw-bold text-primary-emphasis">Detalhes de {{ crismando.nome }}</h2>
        </div>

        <div class="card-body px-4 py-4">
            <form class="row g-4" id="formAtualizacao" action="{{ url_for('atualizar_infor') }}" method="POST">
                <input type="hidden" name="id_crismando" value="{{ crismando.id }}">
                <input type="hidden" name="id_catequista" value="{{ crismando.fk_id_catequista }}">

                <div class="col-md-6">
                    <label class="form-label fw-semibold">Nome</label>
                    <input type="text" name="nome_crismando" class="form-control rounded-3" value="{{ crismando.nome }}">
                </div>

                <div class="col-md-6">
                    <label class="form-label fw-semibold">Data de Nascimento</label>
                    <input type="date" name="data_nascimento" class="form-control rounded-3" value="{{ crismando.data_nascimento }}">
                </div>

                <div class="col-md-6">
                    <label class="form-label fw-semibold">Número para contato 1</label>
                    <input type="text" name="telefone1" class="form-control rounded-3" value="{{ crismando.tel1 }}">
                </div>

                <div class="col-md-6">
                    <label class="form-label fw-semibold">Número para contato 2</label>
                    <input type="text" name="telefone2" class="form-control rounded-3" {% if crismando.tel2 == 'None' or crismando.tel2 == '' %} value='Sem Contato' {% endif %}  value="{{crismando.tel2}}"  >
                </div>

                <div class="col-12">
                    <label class="form-label fw-semibold">Nome da Mãe</label>
                    <input type="text" name="nome_mae" class="form-control rounded-3" value="{{ crismando.nome_mae }}">
                </div>

                <div class="col-12">
                    <label class="form-label fw-semibold">Nome do Pai</label>
                    <input type="text" name="nome_pai" class="form-control rounded-3" value="{{ crismando.nome_pai }}">
                </div>

                <div class="col-md-6">
                    <label class="form-label fw-semibold">Endereço</label>
                    <input type="text" name="endereco" class="form-control rounded-3" value="{{ crismando.endereco }}">
                </div>

                <div class="col-md-6">
                    <label class="form-label fw-semibold">Cidade</label>
                    <input type="text" name="cidade" class="form-control rounded-3" value="{{ crismando.cidade }}">
                </div>

                <div class="col-md-4">
                    <label class="form-label fw-semibold">Status</label>
                    <select name="status_crismando" class="form-select rounded-3">
                        <option value="ativo" {% if crismando.status_crismando == 'ativo' %} selected {% endif %}>Ativo</option>
                        <option value="desistente" {% if crismando.status_crismando == 'desistente' %} selected {% endif %}>Desistente</option>
                    </select>
                </div>

                <div class="col-md-4">
                    <label class="form-label fw-semibold">Recebeu o Batismo?</label>
                    <select name="batismo" class="form-select rounded-3">
                        <option value="sim" {% if crismando.batismo == 'sim' %} selected {% endif %}>Sim</option>
                        <option value="nao" {% if crismando.batismo == 'nao' %} selected {% endif %}>Não</option>
                    </select>
                </div>

                <div class="col-md-4">
                    <label class="form-label fw-semibold">Recebeu a 1ª Eucaristia?</label>
                    <select name="eucaristia" class="form-select rounded-3">
                        <option value="sim" {% if crismando.eucaristia == 'sim' %} selected {% endif %}>Sim</option>
                        <option value="nao" {% if crismando.eucaristia == 'nao' %} selected {% endif %}>Não</option>
                    </select>
                </div>

                <div class="col-md-6">
                    <label class="form-label fw-semibold">Catequista Responsável</label>
                    <select name="catequista_responsavel" id="catequista_responsavel" class="form-select rounded-3">
                        {% for catequista, grupo in lista_catequistas %}
                            <option value="{{ catequista.id_catequista }}"
                                    data-grupo="{{ grupo.nome_grupo if grupo else 'Sem grupo' }}"
                                    {% if catequista.id_catequista == crismando.fk_id_catequista %} selected {% endif %}>
                                {{ catequista.nome }}
                            </option>
                        {% endfor %}
                    </select>
                </div>

                <div class="col-md-6">
                    <label class="form-label fw-semibold">Grupo</label>
                    <input type="text" name="grupo" id="grupo" class="form-control rounded-3" readonly>
                </div>
                

                <div class="col-12 text-center mt-3">
                    <button type="submit" class="btn btn-outline-primary px-4 rounded-pill me-2">Salvar</button>
                    <a href="{{ origem_url_voltar }}" class="btn btn-outline-secondary px-4 rounded-pill">Voltar</a>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
    // Atualiza o campo grupo automaticamente ao trocar o catequista
    const select = document.getElementById('catequista_responsavel');
    const grupoInput = document.getElementById('grupo');

    function atualizarGrupo() {
        const grupo = select.options[select.selectedIndex].dataset.grupo;
        grupoInput.value = grupo;
    }

    // Atualiza ao carregar a página
    window.addEventListener('DOMContentLoaded', atualizarGrupo);

    // Atualiza sempre que mudar o select
    select.addEventListener('change', atualizarGrupo);

    // SweetAlert para confirmação
    document.getElementById("formAtualizacao").addEventListener("submit", function (event) {
        event.preventDefault();

        Swal.fire({
            title: "Tem certeza?",
            text: "Você deseja salvar as alterações?",
            icon: "warning",
            showCancelButton: true,
            confirmButtonText: "Sim, salvar!",
            cancelButtonText: "Cancelar"
        }).then((result) => {
            if (result.isConfirmed) {
                this.submit();
            }
        });
    });
</script>
{% endblock %}
