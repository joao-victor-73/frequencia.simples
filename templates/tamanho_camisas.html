{% extends "base.html" %}

{% block conteudo %}

<div class="container mt-5">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="text-primary fw-bold"> ðŸ‘• Tamanho das camisas</h2>
    </div>

    <table class="table table-bordered table-hover align-middle text-center rounded-3 overflow-hidden">
        <thead class="table-light">
            <tr>
                <th>NÂ°</th>
                <th>Nome</th>
                <th>Data de Nascimento</th>
                <th>Turma</th>
                <th>Tamanho da Camisa</th>
            </tr>
        </thead>
        <tbody>
            {% for c, g in lista_crismandos %}
            <tr>
                <td>{{ loop.index }}</td>
                <td>{{ c.nome }}</td>
                <td>{{ c.data_nascimento.strftime('%d/%m/%Y') if c.data_nascimento else 'N/A' }}</td>
                <td>{{ g.nome_grupo }}</td>
                <td>
                    <select class="form-select form-select-sm tamanho-select" data-id="{{ c.id }}">
                        <option value="">Selecione</option>
                        <option value="PP" {% if c.tamanho_camisa == "PP" %}selected{% endif %}>PP</option>
                        <option value="P" {% if c.tamanho_camisa == "P" %}selected{% endif %}>P</option>
                        <option value="M" {% if c.tamanho_camisa == "M" %}selected{% endif %}>M</option>
                        <option value="G" {% if c.tamanho_camisa == "G" %}selected{% endif %}>G</option>
                        <option value="GG" {% if c.tamanho_camisa == "GG" %}selected{% endif %}>GG</option>
                        <option value="GG" {% if c.tamanho_camisa == "N/A" %}selected{% endif %}>NÃ£o Solicitado</option>
                    </select>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <!-- Mensagem de sucesso/erro -->
    <div id="mensagem" class="mt-3"></div>
</div>

<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script>
$(document).ready(function(){
    $(".tamanho-select").change(function(){
        let id = $(this).data("id");
        let tamanho = $(this).val();

        $.ajax({
            url: "/atualizar_tamanho",
            method: "POST",
            data: { id: id, tamanho: tamanho },
            success: function(response){
                let mensagem = $("#mensagem");
                if(response.status === "success"){
                    mensagem.html(`<div class="alert alert-success">${response.message}</div>`);
                } else {
                    mensagem.html(`<div class="alert alert-danger">${response.message}</div>`);
                }
                setTimeout(() => mensagem.html(""), 2000);
            },
            error: function(){
                $("#mensagem").html(`<div class="alert alert-danger">Erro ao atualizar!</div>`);
            }
        });
    });
});
</script>

{% endblock %}
